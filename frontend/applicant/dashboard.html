<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>My Dashboard - Korea Working Visa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: #f5f5f7; }
        .glass { background: rgba(255,255,255,0.95); backdrop-filter: blur(20px); }
        .card { background: white; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.06); }
        .tab-btn { transition: all 0.2s; }
        .tab-btn.active { color: #007AFF; border-bottom: 2px solid #007AFF; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .status-badge { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .status-pending { background: #FEF3C7; color: #92400E; }
        .status-processing { background: #DBEAFE; color: #1E40AF; }
        .status-approved { background: #D1FAE5; color: #065F46; }
        .status-rejected { background: #FEE2E2; color: #991B1B; }
        .timeline-dot { width: 12px; height: 12px; border-radius: 50%; border: 2px solid; }
        .timeline-dot.done { background: #10B981; border-color: #10B981; }
        .timeline-dot.current { background: #3B82F6; border-color: #3B82F6; animation: pulse 2s infinite; }
        .timeline-dot.pending { background: #E5E7EB; border-color: #D1D5DB; }
        @keyframes pulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(59,130,246,0.4); } 50% { box-shadow: 0 0 0 8px rgba(59,130,246,0); } }
        .quick-action { transition: all 0.2s; }
        .quick-action:hover { transform: translateY(-2px); box-shadow: 0 4px 16px rgba(0,0,0,0.1); }
        .quick-action:active { transform: scale(0.97); }
        /* 모바일 최적화 */
        @media (max-width: 768px) {
            .desktop-only { display: none !important; }
            .mobile-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
            .mobile-tabs::-webkit-scrollbar { display: none; }
        }
        @media (min-width: 769px) {
            .mobile-only { display: none !important; }
        }
    </style>
</head>
<body class="min-h-screen">
<!-- 인증 가드 -->
<script>
    (function() {
        const loggedIn = sessionStorage.getItem('kwv_logged_in');
        const user = sessionStorage.getItem('kwv_user');
        if (loggedIn !== 'true' || !user) {
            window.location.replace('/kwv-login.html');
            return;
        }
        try {
            const u = JSON.parse(user);
            if (u.user_type === 'admin') {
                window.location.replace('/kwv-dashboard.html');
            }
        } catch(e) {}
    })();
</script>

<!-- 헤더 -->
<header class="glass sticky top-0 z-50 border-b border-gray-200/50">
    <div class="max-w-5xl mx-auto px-4 py-3 flex justify-between items-center">
        <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                <i class="fas fa-passport text-white text-sm"></i>
            </div>
            <span class="font-bold text-gray-900 text-sm">Korea Working Visa</span>
        </div>
        <div class="flex items-center space-x-3">
            <select id="langSelector" onchange="changeLanguage(this.value)" class="text-xs border rounded-lg px-2 py-1 bg-white">
                <option value="en">EN</option>
                <option value="ko">한국어</option>
                <option value="vi">Tiếng Việt</option>
                <option value="th">ไทย</option>
                <option value="tl">Filipino</option>
            </select>
            <button onclick="showTab('notifications')" class="relative p-2 text-gray-500 hover:text-gray-700">
                <i class="fas fa-bell"></i>
                <span class="absolute -top-0.5 -right-0.5 w-4 h-4 bg-red-500 text-white text-[9px] rounded-full flex items-center justify-center">2</span>
            </button>
            <div class="relative">
                <button onclick="toggleUserMenu()" class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-user text-white text-xs"></i>
                    </div>
                    <span id="headerUserName" class="text-sm font-medium text-gray-700 hidden md:inline"></span>
                </button>
                <div id="userMenu" class="hidden absolute right-0 top-12 bg-white rounded-xl shadow-xl border py-2 min-w-[160px] z-50">
                    <div class="px-4 py-2 border-b">
                        <p class="text-xs text-gray-400" data-i18n="loggedInAs">Logged in as</p>
                        <p id="menuUserName" class="font-medium text-gray-800 text-sm"></p>
                    </div>
                    <button onclick="showTab('profile')" class="w-full px-4 py-2 text-left text-sm text-gray-700 hover:bg-gray-50"><i class="fas fa-user-edit mr-2 text-gray-400"></i> <span data-i18n="myProfile">My Profile</span></button>
                    <button onclick="logout()" class="w-full px-4 py-2 text-left text-sm text-red-500 hover:bg-red-50"><i class="fas fa-sign-out-alt mr-2"></i> <span data-i18n="logoutBtn">Logout</span></button>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- 탭 네비게이션 -->
<nav class="glass border-b border-gray-200/50 sticky top-[57px] z-40">
    <div class="max-w-5xl mx-auto">
        <div class="mobile-tabs flex">
            <button onclick="showTab('home')" class="tab-btn active flex-shrink-0 px-4 py-3 text-sm font-medium text-blue-600 border-b-2 border-blue-600" data-tab="home">
                <i class="fas fa-home mr-1"></i> <span data-i18n="tabHome">Home</span>
            </button>
            <button onclick="showTab('visa')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="visa">
                <i class="fas fa-passport mr-1"></i> <span data-i18n="tabVisa">Visa</span>
            </button>
            <button onclick="showTab('documents')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="documents">
                <i class="fas fa-folder mr-1"></i> <span data-i18n="tabDocs">Documents</span>
            </button>
            <button onclick="showTab('jobs')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="jobs">
                <i class="fas fa-briefcase mr-1"></i> <span data-i18n="tabJobs">Jobs</span>
            </button>
            <button onclick="showTab('consulting')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="consulting">
                <i class="fas fa-headset mr-1"></i> <span data-i18n="tabConsulting">Consulting</span>
            </button>
            <button onclick="showTab('guide')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="guide">
                <i class="fas fa-book mr-1"></i> <span data-i18n="tabGuide">Guide</span>
            </button>
            <button onclick="showTab('profile')" class="tab-btn flex-shrink-0 px-4 py-3 text-sm font-medium text-gray-500 border-b-2 border-transparent" data-tab="profile">
                <i class="fas fa-user-cog mr-1"></i> <span data-i18n="tabProfile">Profile</span>
            </button>
        </div>
    </div>
</nav>

<!-- 메인 컨텐츠 -->
<main class="max-w-5xl mx-auto px-4 py-6">

    <!-- ==================== 홈 탭 ==================== -->
    <div id="tab-home" class="tab-content active">
        <!-- 환영 카드 -->
        <div class="card p-6 mb-6 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 text-white">
            <p class="text-blue-100 text-sm" id="todayDate"></p>
            <h2 id="welcomeMsg" class="text-xl md:text-2xl font-bold mt-1"></h2>
            <p class="text-white/80 text-sm mt-2" data-i18n="welcomeDesc">Check your visa status and manage your application.</p>
        </div>

        <!-- 신청 상태 요약 -->
        <div class="card p-5 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-gray-800"><i class="fas fa-chart-line mr-2 text-blue-500"></i> <span data-i18n="applicationOverview">Application Overview</span></h3>
                <span class="status-badge status-processing"><i class="fas fa-spinner fa-spin mr-1"></i> <span data-i18n="statusProcessing">Processing</span></span>
            </div>
            <!-- 타임라인 -->
            <div class="flex items-center justify-between mt-4 px-2">
                <div class="flex flex-col items-center">
                    <div class="timeline-dot done"></div>
                    <span class="text-[10px] text-gray-500 mt-1" data-i18n="stepSubmitted">Submitted</span>
                </div>
                <div class="flex-1 h-0.5 bg-green-400 mx-1"></div>
                <div class="flex flex-col items-center">
                    <div class="timeline-dot done"></div>
                    <span class="text-[10px] text-gray-500 mt-1" data-i18n="stepReceived">Received</span>
                </div>
                <div class="flex-1 h-0.5 bg-green-400 mx-1"></div>
                <div class="flex flex-col items-center">
                    <div class="timeline-dot current"></div>
                    <span class="text-[10px] text-blue-600 font-medium mt-1" data-i18n="stepReview">Under Review</span>
                </div>
                <div class="flex-1 h-0.5 bg-gray-200 mx-1"></div>
                <div class="flex flex-col items-center">
                    <div class="timeline-dot pending"></div>
                    <span class="text-[10px] text-gray-400 mt-1" data-i18n="stepDecision">Decision</span>
                </div>
            </div>
            <div class="mt-4 p-3 bg-blue-50 rounded-xl text-sm text-blue-700">
                <i class="fas fa-info-circle mr-1"></i> <span data-i18n="reviewMsg">Your application is currently under review. Expected processing time: 2-3 weeks.</span>
            </div>
        </div>

        <!-- 빠른 액션 -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
            <div onclick="showTab('visa')" class="quick-action card p-4 text-center cursor-pointer">
                <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-passport text-blue-500 text-xl"></i>
                </div>
                <p class="text-xs font-medium text-gray-700" data-i18n="qVisa">Visa Status</p>
            </div>
            <div onclick="showTab('documents')" class="quick-action card p-4 text-center cursor-pointer">
                <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-file-upload text-green-500 text-xl"></i>
                </div>
                <p class="text-xs font-medium text-gray-700" data-i18n="qDocs">Upload Docs</p>
            </div>
            <div onclick="showTab('jobs')" class="quick-action card p-4 text-center cursor-pointer">
                <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-search text-orange-500 text-xl"></i>
                </div>
                <p class="text-xs font-medium text-gray-700" data-i18n="qJobs">Find Jobs</p>
            </div>
            <div onclick="showTab('consulting')" class="quick-action card p-4 text-center cursor-pointer">
                <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mx-auto mb-2">
                    <i class="fas fa-calendar-check text-purple-500 text-xl"></i>
                </div>
                <p class="text-xs font-medium text-gray-700" data-i18n="qConsult">Book Consult</p>
            </div>
        </div>

        <!-- 최근 알림 -->
        <div class="card p-5">
            <h3 class="font-semibold text-gray-800 mb-3"><i class="fas fa-bell mr-2 text-orange-500"></i> <span data-i18n="recentNotifs">Recent Notifications</span></h3>
            <div class="space-y-3">
                <div class="flex items-start space-x-3 p-3 bg-blue-50 rounded-xl">
                    <div class="w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fas fa-file-alt text-blue-600 text-sm"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="notif1Title">Document Verified</p>
                        <p class="text-xs text-gray-500" data-i18n="notif1Desc">Your passport copy has been verified successfully.</p>
                        <p class="text-[10px] text-gray-400 mt-1">2 hours ago</p>
                    </div>
                </div>
                <div class="flex items-start space-x-3 p-3 bg-green-50 rounded-xl">
                    <div class="w-8 h-8 bg-green-200 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5">
                        <i class="fas fa-check text-green-600 text-sm"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="notif2Title">Application Received</p>
                        <p class="text-xs text-gray-500" data-i18n="notif2Desc">Your E-8 visa application has been received and is being processed.</p>
                        <p class="text-[10px] text-gray-400 mt-1">1 day ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 비자 신청 탭 ==================== -->
    <div id="tab-visa" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-passport mr-2 text-blue-500"></i> <span data-i18n="visaTitle">Visa Application</span></h2>
        </div>

        <!-- 현재 신청 상태 -->
        <div class="card p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h3 class="font-semibold text-gray-800" data-i18n="currentApp">Current Application</h3>
                <span class="status-badge status-processing"><i class="fas fa-spinner fa-spin mr-1"></i> Processing</span>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                <div>
                    <p class="text-gray-500 text-xs" data-i18n="visaType">Visa Type</p>
                    <p class="font-medium text-gray-800">E-8 (Seasonal)</p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs" data-i18n="appDate">Applied Date</p>
                    <p class="font-medium text-gray-800">2026-01-28</p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs" data-i18n="nationality">Nationality</p>
                    <p class="font-medium text-gray-800">Vietnam</p>
                </div>
                <div>
                    <p class="text-gray-500 text-xs" data-i18n="passportNo">Passport No.</p>
                    <p class="font-medium text-gray-800">B•••••89</p>
                </div>
            </div>

            <!-- 상세 타임라인 -->
            <div class="mt-6 space-y-4">
                <h4 class="text-sm font-semibold text-gray-700" data-i18n="timeline">Timeline</h4>
                <div class="relative pl-6 border-l-2 border-green-400 space-y-6">
                    <div class="relative">
                        <div class="absolute -left-[25px] w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="tl1">Application Submitted</p>
                        <p class="text-xs text-gray-500">2026-01-28 14:30</p>
                    </div>
                    <div class="relative">
                        <div class="absolute -left-[25px] w-4 h-4 bg-green-500 rounded-full border-2 border-white"></div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="tl2">Documents Verified</p>
                        <p class="text-xs text-gray-500">2026-02-01 09:15</p>
                    </div>
                    <div class="relative">
                        <div class="absolute -left-[25px] w-4 h-4 bg-blue-500 rounded-full border-2 border-white animate-pulse"></div>
                        <p class="text-sm font-medium text-blue-700" data-i18n="tl3">Under Government Review</p>
                        <p class="text-xs text-gray-500" data-i18n="tl3Desc">Estimated completion: 2026-02-20</p>
                    </div>
                </div>
                <div class="relative pl-6 border-l-2 border-dashed border-gray-300 space-y-6">
                    <div class="relative">
                        <div class="absolute -left-[25px] w-4 h-4 bg-gray-200 rounded-full border-2 border-white"></div>
                        <p class="text-sm text-gray-400" data-i18n="tl4">Final Decision</p>
                        <p class="text-xs text-gray-400" data-i18n="tl4Desc">Pending</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 비자 유형 안내 -->
        <div class="card p-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-info-circle text-blue-500 mr-2"></i> <span data-i18n="visaTypes">Visa Types</span></h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 rounded-xl bg-blue-50 border border-blue-200">
                    <h4 class="font-bold text-blue-700 mb-1">E-8</h4>
                    <p class="text-xs text-gray-600" data-i18n="e8Desc">Seasonal Worker visa for agriculture, fishery, etc. Valid for 3-8 months.</p>
                </div>
                <div class="p-4 rounded-xl bg-green-50 border border-green-200">
                    <h4 class="font-bold text-green-700 mb-1">E-9</h4>
                    <p class="text-xs text-gray-600" data-i18n="e9Desc">Non-professional employment visa for manufacturing, construction. Valid up to 3 years.</p>
                </div>
                <div class="p-4 rounded-xl bg-purple-50 border border-purple-200">
                    <h4 class="font-bold text-purple-700 mb-1">H-2</h4>
                    <p class="text-xs text-gray-600" data-i18n="h2Desc">Working Visit visa for ethnic Koreans from specific countries. Valid up to 3 years.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 서류 관리 탭 ==================== -->
    <div id="tab-documents" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-folder-open mr-2 text-green-500"></i> <span data-i18n="docsTitle">Documents</span></h2>
            <button onclick="alert('Upload feature coming soon (prototype)')" class="px-4 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition">
                <i class="fas fa-upload mr-1"></i> <span data-i18n="uploadBtn">Upload</span>
            </button>
        </div>

        <div class="space-y-3">
            <!-- 여권 사본 -->
            <div class="card p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-green-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-passport text-green-500"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="docPassport">Passport Copy</p>
                        <p class="text-xs text-gray-500">passport_scan.pdf · 2.3MB</p>
                    </div>
                </div>
                <span class="status-badge status-approved"><i class="fas fa-check mr-1"></i> <span data-i18n="verified">Verified</span></span>
            </div>
            <!-- 이력서 -->
            <div class="card p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-blue-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-file-alt text-blue-500"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="docResume">Resume / CV</p>
                        <p class="text-xs text-gray-500">resume_2026.pdf · 1.1MB</p>
                    </div>
                </div>
                <span class="status-badge status-approved"><i class="fas fa-check mr-1"></i> <span data-i18n="verified">Verified</span></span>
            </div>
            <!-- 건강검진서 -->
            <div class="card p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-orange-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-heartbeat text-orange-500"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="docHealth">Health Certificate</p>
                        <p class="text-xs text-gray-500">health_cert.pdf · 3.5MB</p>
                    </div>
                </div>
                <span class="status-badge status-processing"><i class="fas fa-clock mr-1"></i> <span data-i18n="reviewing">Reviewing</span></span>
            </div>
            <!-- 범죄경력증명서 -->
            <div class="card p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-purple-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-shield-alt text-purple-500"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="docCriminal">Criminal Record Check</p>
                        <p class="text-xs text-gray-500" data-i18n="notUploaded">Not uploaded yet</p>
                    </div>
                </div>
                <button onclick="alert('Upload feature coming soon (prototype)')" class="px-3 py-1.5 bg-blue-50 text-blue-600 text-xs font-medium rounded-lg hover:bg-blue-100 transition">
                    <i class="fas fa-upload mr-1"></i> <span data-i18n="upload">Upload</span>
                </button>
            </div>
            <!-- 사진 -->
            <div class="card p-4 flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-cyan-100 rounded-xl flex items-center justify-center">
                        <i class="fas fa-camera text-cyan-500"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="docPhoto">ID Photo (3.5x4.5cm)</p>
                        <p class="text-xs text-gray-500">photo.jpg · 512KB</p>
                    </div>
                </div>
                <span class="status-badge status-approved"><i class="fas fa-check mr-1"></i> <span data-i18n="verified">Verified</span></span>
            </div>
        </div>

        <div class="mt-4 p-4 bg-yellow-50 rounded-xl border border-yellow-200 text-sm text-yellow-800">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            <span data-i18n="docWarning">Please upload all required documents to proceed with your visa application. Missing documents may delay processing.</span>
        </div>
    </div>

    <!-- ==================== 구인/구직 탭 ==================== -->
    <div id="tab-jobs" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-briefcase mr-2 text-orange-500"></i> <span data-i18n="jobsTitle">Job Board</span></h2>
        </div>

        <!-- 검색 -->
        <div class="card p-4 mb-6">
            <div class="flex flex-col md:flex-row gap-3">
                <input type="text" placeholder="Search jobs..." class="flex-1 px-4 py-2.5 border rounded-xl text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" data-i18n-placeholder="searchJobs">
                <select class="px-4 py-2.5 border rounded-xl text-sm bg-white">
                    <option data-i18n="allRegions">All Regions</option>
                    <option>Seoul</option>
                    <option>Gyeonggi</option>
                    <option>Chungnam</option>
                    <option>Jeju</option>
                </select>
                <select class="px-4 py-2.5 border rounded-xl text-sm bg-white">
                    <option data-i18n="allTypes">All Types</option>
                    <option data-i18n="agriculture">Agriculture</option>
                    <option data-i18n="manufacturing">Manufacturing</option>
                    <option data-i18n="fishery">Fishery</option>
                </select>
            </div>
        </div>

        <!-- 구인 목록 -->
        <div class="space-y-3">
            <div class="card p-5 hover:shadow-md transition cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">Strawberry Farm Worker</h4>
                        <p class="text-sm text-gray-500 mt-1"><i class="fas fa-building mr-1"></i> Kim's Berry Farm</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full">E-8</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full"><i class="fas fa-map-marker-alt mr-1"></i> Chungnam</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full"><i class="fas fa-won-sign mr-1"></i> 2,200,000/month</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">2 days ago</span>
                </div>
            </div>
            <div class="card p-5 hover:shadow-md transition cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">Factory Assembly Line Worker</h4>
                        <p class="text-sm text-gray-500 mt-1"><i class="fas fa-building mr-1"></i> Daejeon Auto Parts Co.</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full">E-9</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full"><i class="fas fa-map-marker-alt mr-1"></i> Daejeon</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full"><i class="fas fa-won-sign mr-1"></i> 2,500,000/month</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">3 days ago</span>
                </div>
            </div>
            <div class="card p-5 hover:shadow-md transition cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">Oyster Farm Worker</h4>
                        <p class="text-sm text-gray-500 mt-1"><i class="fas fa-building mr-1"></i> Tongyeong Fishery</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full">E-8</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full"><i class="fas fa-map-marker-alt mr-1"></i> Gyeongnam</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full"><i class="fas fa-won-sign mr-1"></i> 2,300,000/month</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">5 days ago</span>
                </div>
            </div>
            <div class="card p-5 hover:shadow-md transition cursor-pointer">
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-semibold text-gray-800">Greenhouse Vegetable Worker</h4>
                        <p class="text-sm text-gray-500 mt-1"><i class="fas fa-building mr-1"></i> Jeju Green Farm</p>
                        <div class="flex flex-wrap gap-2 mt-2">
                            <span class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full">E-8</span>
                            <span class="text-xs bg-gray-100 text-gray-600 px-2 py-0.5 rounded-full"><i class="fas fa-map-marker-alt mr-1"></i> Jeju</span>
                            <span class="text-xs bg-green-100 text-green-600 px-2 py-0.5 rounded-full"><i class="fas fa-won-sign mr-1"></i> 2,100,000/month</span>
                        </div>
                    </div>
                    <span class="text-xs text-gray-400">1 week ago</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 상담 예약 탭 ==================== -->
    <div id="tab-consulting" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-headset mr-2 text-purple-500"></i> <span data-i18n="consultTitle">Consulting</span></h2>
            <button onclick="alert('Booking feature coming soon (prototype)')" class="px-4 py-2 bg-purple-500 text-white text-sm rounded-lg hover:bg-purple-600 transition">
                <i class="fas fa-plus mr-1"></i> <span data-i18n="newBooking">New Booking</span>
            </button>
        </div>

        <!-- 다가오는 상담 -->
        <div class="card p-6 mb-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-calendar-check text-green-500 mr-2"></i> <span data-i18n="upcoming">Upcoming</span></h3>
            <div class="p-4 bg-purple-50 rounded-xl border border-purple-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="font-medium text-gray-800" data-i18n="consultType1">Visa Extension Consultation</p>
                        <p class="text-sm text-gray-500 mt-1"><i class="fas fa-user-tie mr-1"></i> Kim Consultant</p>
                        <p class="text-sm text-purple-600 mt-1"><i class="fas fa-clock mr-1"></i> 2026-02-15 10:00 AM</p>
                    </div>
                    <div class="text-right">
                        <span class="status-badge status-approved">Confirmed</span>
                        <p class="text-xs text-gray-400 mt-2"><i class="fas fa-video mr-1"></i> Online</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 상담 유형 -->
        <div class="card p-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-th-list text-blue-500 mr-2"></i> <span data-i18n="consultTypes">Consultation Types</span></h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="p-4 rounded-xl bg-blue-50 border border-blue-200 cursor-pointer hover:shadow-md transition" onclick="alert('Booking feature (prototype)')">
                    <div class="w-10 h-10 bg-blue-200 rounded-xl flex items-center justify-center mb-3">
                        <i class="fas fa-passport text-blue-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-800 text-sm" data-i18n="ctVisa">Visa Consultation</h4>
                    <p class="text-xs text-gray-500 mt-1" data-i18n="ctVisaDesc">Application, extension, status change</p>
                    <p class="text-xs text-blue-600 font-medium mt-2" data-i18n="free">Free</p>
                </div>
                <div class="p-4 rounded-xl bg-green-50 border border-green-200 cursor-pointer hover:shadow-md transition" onclick="alert('Booking feature (prototype)')">
                    <div class="w-10 h-10 bg-green-200 rounded-xl flex items-center justify-center mb-3">
                        <i class="fas fa-briefcase text-green-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-800 text-sm" data-i18n="ctJob">Employment Consultation</h4>
                    <p class="text-xs text-gray-500 mt-1" data-i18n="ctJobDesc">Job search, workplace issues, contracts</p>
                    <p class="text-xs text-blue-600 font-medium mt-2" data-i18n="free">Free</p>
                </div>
                <div class="p-4 rounded-xl bg-red-50 border border-red-200 cursor-pointer hover:shadow-md transition" onclick="alert('Booking feature (prototype)')">
                    <div class="w-10 h-10 bg-red-200 rounded-xl flex items-center justify-center mb-3">
                        <i class="fas fa-gavel text-red-600"></i>
                    </div>
                    <h4 class="font-semibold text-gray-800 text-sm" data-i18n="ctLegal">Legal Consultation</h4>
                    <p class="text-xs text-gray-500 mt-1" data-i18n="ctLegalDesc">Labor rights, disputes, legal advice</p>
                    <p class="text-xs text-blue-600 font-medium mt-2" data-i18n="free">Free</p>
                </div>
            </div>
        </div>

        <!-- 긴급 연락처 -->
        <div class="card p-6 mt-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-phone-alt text-red-500 mr-2"></i> <span data-i18n="emergency">Emergency Contacts</span></h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="p-3 bg-red-50 rounded-xl flex items-center space-x-3">
                    <div class="w-10 h-10 bg-red-200 rounded-full flex items-center justify-center">
                        <i class="fas fa-phone text-red-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="hotline">Immigration Hotline</p>
                        <p class="text-sm text-blue-600 font-bold">1345</p>
                    </div>
                </div>
                <div class="p-3 bg-blue-50 rounded-xl flex items-center space-x-3">
                    <div class="w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center">
                        <i class="fas fa-hands-helping text-blue-600"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-gray-800" data-i18n="laborHelp">Labor Rights Center</p>
                        <p class="text-sm text-blue-600 font-bold">1350</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 비자 가이드 탭 ==================== -->
    <div id="tab-guide" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-book mr-2 text-indigo-500"></i> <span data-i18n="guideTitle">Visa Guide</span></h2>
        </div>

        <!-- FAQ -->
        <div class="card p-6 mb-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-question-circle text-blue-500 mr-2"></i> <span data-i18n="faq">FAQ</span></h3>
            <div class="space-y-3">
                <details class="bg-gray-50 rounded-xl p-4 cursor-pointer">
                    <summary class="font-medium text-gray-800 text-sm" data-i18n="fq1">What documents do I need for E-8 visa?</summary>
                    <p class="text-sm text-gray-600 mt-2" data-i18n="fa1">You need: passport, application form, ID photo, employment contract, health certificate, criminal record check, and proof of qualification from your home country.</p>
                </details>
                <details class="bg-gray-50 rounded-xl p-4 cursor-pointer">
                    <summary class="font-medium text-gray-800 text-sm" data-i18n="fq2">How long does visa processing take?</summary>
                    <p class="text-sm text-gray-600 mt-2" data-i18n="fa2">E-8 visa typically takes 2-4 weeks. E-9 visa may take 1-3 months depending on the bilateral agreement between countries.</p>
                </details>
                <details class="bg-gray-50 rounded-xl p-4 cursor-pointer">
                    <summary class="font-medium text-gray-800 text-sm" data-i18n="fq3">Can I change my employer?</summary>
                    <p class="text-sm text-gray-600 mt-2" data-i18n="fa3">Under E-9 visa, workplace change is allowed under certain conditions such as unfair treatment, company closure, or with approval from the Employment Permit System.</p>
                </details>
                <details class="bg-gray-50 rounded-xl p-4 cursor-pointer">
                    <summary class="font-medium text-gray-800 text-sm" data-i18n="fq4">How to extend my visa?</summary>
                    <p class="text-sm text-gray-600 mt-2" data-i18n="fa4">Apply at the local immigration office at least 1 month before expiry. You need employer confirmation, updated health certificate, and extension application form.</p>
                </details>
            </div>
        </div>

        <!-- 필요 서류 체크리스트 -->
        <div class="card p-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-clipboard-list text-green-500 mr-2"></i> <span data-i18n="checklist">Required Documents Checklist</span></h3>
            <div class="space-y-2">
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" checked disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl1">Valid Passport (6+ months remaining)</span>
                </label>
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" checked disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl2">Passport-size Photo (3.5x4.5cm)</span>
                </label>
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" checked disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl3">Resume / CV</span>
                </label>
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl4">Health Certificate</span>
                </label>
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl5">Criminal Record Check</span>
                </label>
                <label class="flex items-center p-3 bg-gray-50 rounded-xl cursor-pointer hover:bg-gray-100 transition">
                    <input type="checkbox" disabled class="w-4 h-4 accent-green-500 mr-3"> <span class="text-sm text-gray-700" data-i18n="cl6">Employment Contract</span>
                </label>
            </div>
        </div>
    </div>

    <!-- ==================== 알림 탭 ==================== -->
    <div id="tab-notifications" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-bell mr-2 text-orange-500"></i> <span data-i18n="notifsTitle">Notifications</span></h2>
            <button class="text-sm text-blue-600 font-medium" data-i18n="markAllRead">Mark all as read</button>
        </div>
        <div class="space-y-3">
            <div class="card p-4 border-l-4 border-blue-500">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-file-alt text-blue-500 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800" data-i18n="n1">Document Verified: Passport Copy</p>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="n1d">Your passport copy has been verified and approved.</p>
                        <p class="text-[10px] text-gray-400 mt-1">2 hours ago</p>
                    </div>
                    <span class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"></span>
                </div>
            </div>
            <div class="card p-4 border-l-4 border-green-500">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-green-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-check-circle text-green-500 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800" data-i18n="n2">Application Status Update</p>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="n2d">Your application has moved to "Under Review" stage.</p>
                        <p class="text-[10px] text-gray-400 mt-1">1 day ago</p>
                    </div>
                    <span class="w-2 h-2 bg-blue-500 rounded-full flex-shrink-0 mt-2"></span>
                </div>
            </div>
            <div class="card p-4 border-l-4 border-purple-500">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-calendar text-purple-500 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800" data-i18n="n3">Consultation Confirmed</p>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="n3d">Your visa extension consultation is confirmed for Feb 15, 10:00 AM.</p>
                        <p class="text-[10px] text-gray-400 mt-1">2 days ago</p>
                    </div>
                </div>
            </div>
            <div class="card p-4 border-l-4 border-orange-500">
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-orange-100 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-exclamation-triangle text-orange-500 text-sm"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-800" data-i18n="n4">Document Required</p>
                        <p class="text-xs text-gray-500 mt-1" data-i18n="n4d">Please upload your criminal record check to complete your application.</p>
                        <p class="text-[10px] text-gray-400 mt-1">3 days ago</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ==================== 프로필 탭 ==================== -->
    <div id="tab-profile" class="tab-content">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold text-gray-800"><i class="fas fa-user-cog mr-2 text-gray-600"></i> <span data-i18n="profileTitle">My Profile</span></h2>
        </div>

        <div class="card p-6 mb-6">
            <div class="flex items-center space-x-4 mb-6">
                <div class="w-16 h-16 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                    <i class="fas fa-user text-white text-2xl"></i>
                </div>
                <div>
                    <p id="profileName" class="text-lg font-bold text-gray-800"></p>
                    <p id="profileEmail" class="text-sm text-gray-500"></p>
                    <span class="text-xs bg-blue-100 text-blue-600 px-2 py-0.5 rounded-full mt-1 inline-block" data-i18n="applicantBadge">Visa Applicant</span>
                </div>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="pfName">Full Name</label>
                        <input type="text" id="pfNameInput" class="w-full px-4 py-2.5 border rounded-xl text-sm" disabled>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="pfEmail">Email</label>
                        <input type="email" id="pfEmailInput" class="w-full px-4 py-2.5 border rounded-xl text-sm bg-gray-50" disabled>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="pfPhone">Phone</label>
                        <input type="tel" id="pfPhoneInput" class="w-full px-4 py-2.5 border rounded-xl text-sm" placeholder="+82-10-XXXX-XXXX" disabled>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-i18n="pfLang">Preferred Language</label>
                        <select id="pfLangInput" class="w-full px-4 py-2.5 border rounded-xl text-sm bg-white" disabled>
                            <option value="en">English</option>
                            <option value="ko">한국어</option>
                            <option value="vi">Tiếng Việt</option>
                            <option value="th">ภาษาไทย</option>
                            <option value="tl">Filipino</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-3">
                    <button onclick="toggleProfileEdit()" id="editProfileBtn" class="px-4 py-2 bg-blue-500 text-white text-sm rounded-lg hover:bg-blue-600 transition">
                        <i class="fas fa-edit mr-1"></i> <span data-i18n="editBtn">Edit</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 비밀번호 변경 -->
        <div class="card p-6 mb-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-key text-orange-500 mr-2"></i> <span data-i18n="changePw">Change Password</span></h3>
            <div class="space-y-3 max-w-md">
                <input type="password" placeholder="Current password" class="w-full px-4 py-2.5 border rounded-xl text-sm">
                <input type="password" placeholder="New password" class="w-full px-4 py-2.5 border rounded-xl text-sm">
                <input type="password" placeholder="Confirm new password" class="w-full px-4 py-2.5 border rounded-xl text-sm">
                <button onclick="alert('Password change feature (prototype)')" class="px-4 py-2 bg-orange-500 text-white text-sm rounded-lg hover:bg-orange-600 transition">
                    <i class="fas fa-save mr-1"></i> <span data-i18n="updatePw">Update Password</span>
                </button>
            </div>
        </div>

        <!-- 계정 관리 -->
        <div class="card p-6">
            <h3 class="font-semibold text-gray-800 mb-4"><i class="fas fa-cog text-gray-500 mr-2"></i> <span data-i18n="accountSettings">Account Settings</span></h3>
            <div class="space-y-3">
                <button onclick="logout()" class="w-full flex items-center justify-between p-3 bg-gray-50 rounded-xl hover:bg-gray-100 transition">
                    <div class="flex items-center"><i class="fas fa-sign-out-alt text-gray-400 mr-3"></i><span class="text-sm text-gray-700" data-i18n="logoutBtn">Logout</span></div>
                    <i class="fas fa-chevron-right text-gray-300"></i>
                </button>
                <button onclick="if(confirm('Are you sure?')) alert('Account deletion (prototype)')" class="w-full flex items-center justify-between p-3 bg-red-50 rounded-xl hover:bg-red-100 transition">
                    <div class="flex items-center"><i class="fas fa-trash text-red-400 mr-3"></i><span class="text-sm text-red-600" data-i18n="deleteAccount">Delete Account</span></div>
                    <i class="fas fa-chevron-right text-red-300"></i>
                </button>
            </div>
        </div>
    </div>

</main>

<!-- 푸터 -->
<footer class="text-center py-6 text-gray-400 text-xs">
    &copy; 2026 Korea Working Visa. All rights reserved.
</footer>

<script>
    const API_BASE = '/api/kwv';
    let currentLang = localStorage.getItem('kwv_language') || 'en';
    let currentUser = null;

    // ==================== 다국어 ====================
    const translations = {
        en: {
            tabHome: 'Home', tabVisa: 'Visa', tabDocs: 'Documents', tabJobs: 'Jobs',
            tabConsulting: 'Consulting', tabGuide: 'Guide', tabProfile: 'Profile',
            welcomePrefix: 'Hello, ', welcomeSuffix: '!',
            welcomeDesc: 'Check your visa status and manage your application.',
            logoutBtn: 'Logout', myProfile: 'My Profile', loggedInAs: 'Logged in as'
        },
        ko: {
            tabHome: '홈', tabVisa: '비자 신청', tabDocs: '서류 관리', tabJobs: '구인/구직',
            tabConsulting: '상담 예약', tabGuide: '가이드', tabProfile: '내 정보',
            welcomePrefix: '안녕하세요, ', welcomeSuffix: '님!',
            welcomeDesc: '비자 상태를 확인하고 신청을 관리하세요.',
            logoutBtn: '로그아웃', myProfile: '내 프로필', loggedInAs: '로그인 계정',
            applicationOverview: '신청 현황', statusProcessing: '심사 중',
            stepSubmitted: '접수', stepReceived: '서류확인', stepReview: '심사 중', stepDecision: '결정',
            reviewMsg: '신청서가 현재 심사 중입니다. 예상 처리 기간: 2-3주.',
            qVisa: '비자 현황', qDocs: '서류 업로드', qJobs: '일자리 찾기', qConsult: '상담 예약',
            recentNotifs: '최근 알림',
            visaTitle: '비자 신청', docsTitle: '서류 관리', jobsTitle: '구인/구직',
            consultTitle: '상담 예약', guideTitle: '비자 가이드', notifsTitle: '알림',
            profileTitle: '내 정보', changePw: '비밀번호 변경', accountSettings: '계정 관리',
            editBtn: '수정', uploadBtn: '업로드', verified: '확인됨', reviewing: '검토 중',
            notUploaded: '미업로드', upload: '업로드',
            emergency: '긴급 연락처', hotline: '외국인 상담전화', laborHelp: '노동인권 상담',
            faq: '자주 묻는 질문', checklist: '필요 서류 체크리스트',
            markAllRead: '모두 읽음',
            applicantBadge: '비자 신청자',
            free: '무료', newBooking: '새 예약', upcoming: '다가오는 상담',
            deleteAccount: '계정 삭제', updatePw: '비밀번호 변경'
        },
        vi: {
            tabHome: 'Trang chủ', tabVisa: 'Visa', tabDocs: 'Tài liệu', tabJobs: 'Việc làm',
            tabConsulting: 'Tư vấn', tabGuide: 'Hướng dẫn', tabProfile: 'Hồ sơ',
            welcomePrefix: 'Xin chào, ', welcomeSuffix: '!',
            logoutBtn: 'Đăng xuất', myProfile: 'Hồ sơ của tôi'
        },
        th: {
            tabHome: 'หน้าแรก', tabVisa: 'วีซ่า', tabDocs: 'เอกสาร', tabJobs: 'งาน',
            tabConsulting: 'ปรึกษา', tabGuide: 'คู่มือ', tabProfile: 'โปรไฟล์',
            welcomePrefix: 'สวัสดี, ', welcomeSuffix: '!',
            logoutBtn: 'ออกจากระบบ', myProfile: 'โปรไฟล์ของฉัน'
        },
        tl: {
            tabHome: 'Home', tabVisa: 'Visa', tabDocs: 'Dokumento', tabJobs: 'Trabaho',
            tabConsulting: 'Konsulta', tabGuide: 'Gabay', tabProfile: 'Profile',
            welcomePrefix: 'Kumusta, ', welcomeSuffix: '!',
            logoutBtn: 'Mag-logout', myProfile: 'Aking Profile'
        }
    };

    function t(key) {
        return (translations[currentLang] || translations.en)[key] || (translations.en[key] || '');
    }

    function changeLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('kwv_language', lang);
        applyTranslations();
    }

    function applyTranslations() {
        const tr = translations[currentLang] || translations.en;
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (tr[key]) el.textContent = tr[key];
        });
        document.getElementById('langSelector').value = currentLang;
    }

    // ==================== UI ====================
    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => {
            el.classList.remove('active', 'text-blue-600');
            el.classList.add('text-gray-500');
            el.style.borderBottomColor = 'transparent';
        });
        const tab = document.getElementById('tab-' + tabName);
        if (tab) tab.classList.add('active');
        const btn = document.querySelector(`[data-tab="${tabName}"]`);
        if (btn) {
            btn.classList.add('active', 'text-blue-600');
            btn.classList.remove('text-gray-500');
            btn.style.borderBottomColor = '#007AFF';
        }
    }

    function toggleUserMenu() {
        document.getElementById('userMenu').classList.toggle('hidden');
    }

    function toggleProfileEdit() {
        const inputs = document.querySelectorAll('#tab-profile input:not([type="password"]), #tab-profile select');
        const btn = document.getElementById('editProfileBtn');
        const isEditing = !inputs[0].disabled;
        inputs.forEach(i => { if (!i.classList.contains('bg-gray-50')) i.disabled = isEditing; });
        btn.innerHTML = isEditing
            ? '<i class="fas fa-edit mr-1"></i> Edit'
            : '<i class="fas fa-save mr-1"></i> Save';
        if (isEditing) alert('Profile updated (prototype)');
    }

    function logout() {
        sessionStorage.removeItem('kwv_logged_in');
        sessionStorage.removeItem('kwv_user');
        sessionStorage.removeItem('kwv_user_type');
        sessionStorage.removeItem('kwv_token');
        localStorage.removeItem('kwv_logged_in');
        localStorage.removeItem('kwv_user');
        localStorage.removeItem('kwv_token');
        localStorage.removeItem('kwv_username');
        window.location.replace('/kwv-login.html');
    }

    // ==================== 초기화 ====================
    document.addEventListener('DOMContentLoaded', () => {
        const userStr = sessionStorage.getItem('kwv_user');
        if (userStr) {
            try {
                currentUser = JSON.parse(userStr);
                const name = currentUser.name || currentUser.email || 'User';
                document.getElementById('headerUserName').textContent = name;
                document.getElementById('menuUserName').textContent = name;
                document.getElementById('profileName').textContent = name;
                document.getElementById('profileEmail').textContent = currentUser.email || '';
                document.getElementById('pfNameInput').value = name;
                document.getElementById('pfEmailInput').value = currentUser.email || '';
                document.getElementById('pfLangInput').value = currentLang;

                const tr = translations[currentLang] || translations.en;
                document.getElementById('welcomeMsg').textContent = (tr.welcomePrefix || 'Hello, ') + name + (tr.welcomeSuffix || '!');
            } catch(e) {}
        }

        // 오늘 날짜
        const today = new Date();
        const dateEl = document.getElementById('todayDate');
        if (dateEl) {
            if (currentLang === 'ko') {
                dateEl.textContent = `${today.getFullYear()}년 ${today.getMonth()+1}월 ${today.getDate()}일`;
            } else {
                const months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
                dateEl.textContent = `${months[today.getMonth()]} ${today.getDate()}, ${today.getFullYear()}`;
            }
        }

        applyTranslations();
    });

    // 외부 클릭 시 메뉴 닫기
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('userMenu');
        if (menu && !menu.classList.contains('hidden') && !e.target.closest('.relative')) {
            menu.classList.add('hidden');
        }
    });
</script>
</body>
</html>
